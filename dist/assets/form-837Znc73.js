import"./style-Bj0xmOQp.js";import{G as T}from"./localstoragedata-CAic1If1.js";import{g as E}from"./GetApi-D0E96TSk.js";const q=document.querySelector("#final-item-template"),h=document.querySelector(".TotalTemplate"),P=document.querySelector(".products-Detail"),C=document.querySelector(".product-detail-mobile"),x=document.querySelector(".total-final-product-price"),_=document.querySelector(".total-final-price-mobile"),b=T();let l=0;b.forEach(e=>{const{id:t,Productprice:r,quantity:o}=e;l+=r*o});let s=0;l>999&&(s=l*.1);const w=async()=>{const e=await E();b.forEach(t=>{let{id:r,Productprice:o,quantity:i}=t;const a=e.findIndex(d=>d.id===r),c=document.importNode(q.content,!0);c.querySelector(".item-image img").src=e[a].image[0],c.querySelector(".quantity").innerText=i,c.querySelector(".item-name p").innerText=e[a].name,c.querySelector(".item-price p").innerText=`₹${o}`,P.append(c);const n=document.importNode(q.content,!0);n.querySelector(".item-image img").src=e[a].image[0],n.querySelector(".quantity").innerText=i,n.querySelector(".item-name p").innerText=e[a].name,n.querySelector(".item-price p").innerText=`₹${o}`,C.append(n)})},k=()=>{const e=document.importNode(h.content,!0);e.querySelector(".product-final-price").innerText=`Total - ₹${l}`,e.querySelector(".product-final-charges").innerText="Delivery - Free",e.querySelector(".product-final-Discount").innerText=`Discount - ₹${s}`,e.querySelector(".product-final-total").innerText=`Estimate Total - ₹${l-s}`,x.append(e);const t=document.importNode(h.content,!0);t.querySelector(".product-final-price").innerText=`Total - ₹${l}`,t.querySelector(".product-final-charges").innerText="Delivery - Free",t.querySelector(".product-final-Discount").innerText=`Discount - ₹${s}`,t.querySelector(".product-final-total").innerText=`Estimate Total - ₹${l-s}`,_.append(t)},v=async()=>{const e=await E(),t=[];return T().forEach(o=>{const i=e.findIndex(c=>c.id===o.id),a=e[i];t.push({ProductId:a._id,ProductName:a.name,ProductPrice:a.price,ProductQuantity:o.quantity,ProductTotalCost:a.price*o.quantity,ProductImage:a.image[0]})}),t};let g=0;const $=async()=>((await v()).forEach(t=>{g+=t.ProductTotalCost}),g),D=[document.querySelector(".useremail input"),document.querySelector(".usermobile input"),document.querySelector(".userzipcode input")],M={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,number:/^\d{10}$/,pin:/^\d{6}$/},m=(e,t)=>{const r=e.parentElement.querySelector(".error-for-email p"),o=e.parentElement.querySelector(".emptyerr p");return M[t].test(e.value.trim())?(r.style.display="none",e.style.borderColor="#32130a",!0):(r.innerHTML=`Enter a valid ${e.name}`,r.style.display="block",o.style.display="none",e.style.borderColor="red",!1)},I=()=>{D.forEach(e=>{const t=e.name;e.addEventListener("input",()=>m(e,t)),e.addEventListener("blur",()=>m(e,t))})},F=()=>{let e=!0;return D.forEach(t=>{const r=t.name;m(t,r)||(e=!1)}),e},y=[document.querySelector("#input1"),document.querySelector("#input2"),document.querySelector("#input3"),document.querySelector("#input4"),document.querySelector("#input5"),document.querySelector("#input6"),document.querySelector("#input8"),document.querySelector("#input9")],p=document.querySelectorAll(".emptyerr"),N=document.querySelector("form"),O=()=>{y.forEach((e,t)=>{e.value.trim()!=""&&(p[t].style.display="none")})};y.forEach((e,t)=>{e.addEventListener("input",O)});I();N.addEventListener("submit",async function(e){e.preventDefault();let t=!0;if(y.forEach((r,o)=>{F()||(t=!1),r.value.trim()===""?(p[o].style.display="block",t=!1):p[o].style.display="none"}),!t){console.log("Form validation failed");return}try{let r=await $(),o=await v();if(!Array.isArray(o)||o.length===0){console.error("CartDetail is invalid or empty:",o);return}const i=new FormData(this),a=Object.fromEntries(i.entries());a.products=o,a.TotalBill=r;const n=await(await fetch("https://soulmatechocolate.in/api/createOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();if(n.success){const d={key:n.key_id,amount:n.amount,currency:"INR",name:n.product_name,description:n.description,image:a.products[0].ProductImage,order_id:n.order_id,handler:async function(u){if((await(await fetch("https://soulmatechocolate.in/api/verifyPayment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_id:u.razorpay_payment_id,order_id:u.razorpay_order_id,signature:u.razorpay_signature})})).json()).success){let S=function(){document.getElementById("orderSuccessModal").style.display="none",window.open("https://soulmatechocolate.in/","_self")};document.getElementById("orderSuccessModal").style.display="block",document.querySelector(".close").onclick=S,document.getElementById("modalCloseButton").onclick=S}else alert("Payment verification failed.")},prefill:{name:n.name,email:n.email,contact:n.contact},theme:{color:"#2300a3"}},f=new Razorpay(d);f.on("payment.failed",function(u){alert("Payment Failed")}),f.open()}else alert(n.msg)}catch(r){console.error("Error during form submission or payment:",r)}});w();k();
